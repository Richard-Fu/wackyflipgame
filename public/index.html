<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Wacky Flip - Play Free Online Physics Flip Game | Master Crazy Stunts
    </title>
    <meta
      name="description"
      content="Play Wacky Flip Game free online! Master backflips, pike twists & crazy stunts in this addictive physics-based parkour game. No download required - start flipping now!"
    />
    <meta
      name="keywords"
      content="Wacky Flip, flip game, physics game, parkour game, online game, free game, skill game, backflip, stunt game, ragdoll physics, browser game, HTML5 game"
    />
    <link rel="canonical" href="https://wackyflipgame.me" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0Ij4KICA8IS0tIEJhY2tncm91bmQgY2lyY2xlIC0tPgogIDxjaXJjbGUgY3g9IjMyIiBjeT0iMzIiIHI9IjMwIiBmaWxsPSIjMzQ5OGRiIiBzdHJva2U9IiMyOTgwYjkiIHN0cm9rZS13aWR0aD0iMiIvPgogIAogIDwhLS0gRmxpcCBjaGFyYWN0ZXIgLS0+CiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIsMzIpIj4KICAgIDwhLS0gQm9keSAtLT4KICAgIDxlbGxpcHNlIGN4PSIwIiBjeT0iMiIgcng9IjgiIHJ5PSIxMiIgZmlsbD0iI2U3NGMzYyIgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIi8+CiAgICAKICAgIDwhLS0gSGVhZCAtLT4KICAgIDxjaXJjbGUgY3g9Ii02IiBjeT0iLTgiIHI9IjYiIGZpbGw9IiNmMzljMTIiLz4KICAgIAogICAgPCEtLSBBcm1zIC0tPgogICAgPGxpbmUgeDE9Ii0xMiIgeTE9Ii0yIiB4Mj0iLTE4IiB5Mj0iLTgiIHN0cm9rZT0iI2U3NGMzYyIgc3Ryb2tlLXdpZHRoPSIzIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICAgIDxsaW5lIHgxPSI0IiB5MT0iNiIgeDI9IjEwIiB5Mj0iMTIiIHN0cm9rZT0iI2U3NGMzYyIgc3Ryb2tlLXdpZHRoPSIzIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KICAgIAogICAgPCEtLSBMZWdzIC0tPgogICAgPGxpbmUgeDE9Ii0yIiB5MT0iMTAiIHgyPSItOCIgeTI9IjE4IiBzdHJva2U9IiNlNzRjM2MiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CiAgICA8bGluZSB4MT0iNiIgeTE9IjE0IiB4Mj0iMTIiIHkyPSIyMCIgc3Ryb2tlPSIjZTc0YzNjIiBzdHJva2Utd2lkdGg9IjMiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgogIDwvZz4KICA8IS0tIE1vdGlvbiBsaW5lcyAtLT4KICA8cGF0aCBkPSJNOCAxNiBRMTYgMTIgMjQgMTYiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIiBvcGFjaXR5PSIwLjciLz4KICA8cGF0aCBkPSJNNDAgNDggUTQ4IDQ0IDU2IDQ4IiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0ibm9uZSIgb3BhY2l0eT0iMC43Ii8+CiAgPCEtLSBHYW1lIGNvbnRyb2xsZXIgaWNvbiAoc21hbGwpIC0tPgogIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4LDE2KSBzY2FsZSgwLjMpIj4KICAgIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIxMiIgcng9IjYiIGZpbGw9IiMzNDQ5NWUiLz4KICAgIDxjaXJjbGUgY3g9IjQiIGN5PSI2IiByPSIyIiBmaWxsPSIjZmZmZmZmIi8+CiAgICA8Y2lyY2xlIGN4PSIxNiIgY3k9IjYiIHI9IjIiIGZpbGw9IiNmZmZmZmYiLz4KICA8L2c+Cjwvc3ZnPg=="
    />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.svg" />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GGT9J10SJH"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-GGT9J10SJH");
    </script>

    <!-- Vercel Analytics -->
    <script>
      window.va =
        window.va ||
        function () {
          (window.vaq = window.vaq || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .game-container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
        position: relative;
      }

      .game-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .game-title {
        font-size: 1.2em;
        font-weight: bold;
        color: #2c3e50;
        margin: 0;
      }

      .game-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .fullscreen-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
      }

      .fullscreen-btn:hover {
        background: #8e44ad;
        color: white;
      }

      .fullscreen-btn.active {
        background: #8e44ad;
        color: white;
      }

      .fullscreen-btn svg {
        width: 18px;
        height: 18px;
      }

      .game-frame {
        width: 100%;
        max-width: 1280px;
        height: 720px;
        border: none;
        border-radius: 8px;
        display: block;
        background: #f5f5f5;
        will-change: transform, width, height;
        transform: translateZ(0); /* 启用硬件加速 */
      }

      /* Loading indicator styles */
      .loading-indicator {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 10;
        background: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e0e0e0;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-indicator p {
        margin: 0;
        color: #2c3e50;
        font-weight: 600;
      }

      .loading-indicator.hidden {
        display: none;
      }

      /* Game Control Bar Styles */
      .game-control-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: #2c3e50;
        border-radius: 0 0 8px 8px;
        margin-top: -8px;
      }

      .game-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .game-icon img {
        border-radius: 6px;
        background: white;
        padding: 2px;
      }

      .game-details h4 {
        color: white;
        margin: 0;
        font-size: 1.1em;
        font-weight: 600;
      }

      .game-stats {
        display: flex;
        gap: 15px;
        margin-top: 4px;
      }

      .likes-count,
      .dislikes-count {
        color: #bdc3c7;
        font-size: 0.9em;
      }

      .likes-count {
        color: #27ae60;
      }

      .dislikes-count {
        color: #e74c3c;
      }

      .game-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .action-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .action-btn {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: #bdc3c7;
        padding: 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .action-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: translateY(-1px);
      }

      .action-btn svg {
        width: 20px;
        height: 20px;
      }

      .like-btn:hover {
        background: #27ae60;
        color: white;
      }

      .like-btn.active {
        background: #27ae60;
        color: white;
      }

      .dislike-btn:hover {
        background: #e74c3c;
        color: white;
      }

      .dislike-btn.active {
        background: #e74c3c;
        color: white;
      }

      .share-btn:hover {
        background: #3498db;
        color: white;
      }

      .report-btn:hover {
        background: #f39c12;
        color: white;
      }

      .help-btn:hover {
        background: #9b59b6;
        color: white;
      }

      .changelog-btn:hover {
        background: #34495e;
        color: white;
      }

      .refresh-btn:hover {
        background: #27ae60;
        color: white;
      }

      .likes-count,
      .dislikes-count {
        color: #bdc3c7;
        font-size: 0.8em;
        font-weight: 600;
        min-width: 30px;
        text-align: center;
      }

      .likes-count {
        color: #27ae60;
      }

      .dislikes-count {
        color: #e74c3c;
      }

      /* Rating Component Styles */
      .rating-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .rating-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
      }

      .rating-score {
        font-size: 3em;
        font-weight: bold;
        color: #e74c3c;
      }

      .rating-stars {
        display: flex;
        gap: 5px;
      }

      .star {
        font-size: 2em;
        color: #ffd700;
      }

      .star.empty {
        color: #ddd;
      }

      .rating-info {
        color: #666;
        margin-bottom: 20px;
      }

      .user-rating {
        margin-top: 20px;
      }

      .user-rating h4 {
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .rating-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .rating-btn {
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
        padding: 5px;
        transition: transform 0.2s ease;
      }

      .rating-btn:hover {
        transform: scale(1.2);
      }

      .rating-btn.selected {
        color: #ffd700;
      }

      .rating-btn.unselected {
        color: #ddd;
      }

      /* Comments Section Styles */
      .comments-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .comment-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #2c3e50;
      }

      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-family: inherit;
      }

      .form-group textarea {
        height: 100px;
        resize: vertical;
      }

      .submit-btn {
        background: #3498db;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
        transition: background-color 0.3s ease;
      }

      .submit-btn:hover {
        background: #2980b9;
      }

      .comments-list {
        max-height: 500px;
        overflow-y: auto;
      }

      .comment {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #3498db;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .comment-author {
        font-weight: bold;
        color: #2c3e50;
      }

      .comment-date {
        color: #666;
        font-size: 0.9em;
      }

      .comment-text {
        color: #333;
        line-height: 1.5;
      }

      .no-comments {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 20px;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 2.5em;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .subtitle {
        font-size: 1.2em;
        color: #7f8c8d;
        margin-bottom: 20px;
      }

      .content-section {
        background: white;
        padding: 30px;
        margin-bottom: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #2c3e50;
        font-size: 1.8em;
        margin-bottom: 20px;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }

      h3 {
        color: #34495e;
        font-size: 1.3em;
        margin: 20px 0 10px 0;
      }

      .how-to-play {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .step {
        background: #ecf0f1;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #3498db;
      }

      .step h4 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .advantages {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .advantage {
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        transition: transform 0.3s ease;
      }

      .advantage:hover {
        transform: translateY(-5px);
      }

      .advantage-icon {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .faq-item {
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
      }

      .faq-question {
        background: #f8f9fa;
        padding: 15px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .faq-question:hover {
        background: #e9ecef;
      }

      .faq-answer {
        padding: 15px;
        background: white;
      }

      .controls-list {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .controls-list ul {
        list-style: none;
      }

      .controls-list li {
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .controls-list li:last-child {
        border-bottom: none;
      }

      .highlight {
        background: linear-gradient(120deg, #a8e6cf 0%, #dcedc1 100%);
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #27ae60;
      }

      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }

        h1 {
          font-size: 2em;
        }

        .game-frame {
          height: 400px;
        }

        .content-section {
          padding: 20px;
        }

        .rating-display {
          flex-direction: column;
          gap: 10px;
        }

        .rating-score {
          font-size: 2em;
        }

        .game-header {
          flex-direction: column;
          gap: 10px;
          text-align: center;
        }

        .game-title {
          font-size: 1em;
        }

        .fullscreen-btn {
          padding: 10px 20px;
          font-size: 1em;
        }

        .fullscreen-btn svg {
          width: 18px;
          height: 18px;
        }

        /* Mobile fullscreen adjustments */
        .game-container.fullscreen .game-header {
          padding: 15px;
          flex-direction: row;
          justify-content: space-between;
        }

        .game-container.fullscreen .game-title {
          font-size: 0.9em;
        }

        .game-container.fullscreen .fullscreen-btn {
          padding: 8px 16px;
          font-size: 0.9em;
        }

        /* Mobile game control bar */
        .game-control-bar {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .game-info {
          justify-content: center;
        }

        .game-actions {
          justify-content: center;
          flex-wrap: wrap;
          gap: 12px;
        }

        .action-btn {
          padding: 12px;
        }

        .action-btn svg {
          width: 18px;
          height: 18px;
        }

        /* Mobile fullscreen styles */
        .game-container.fullscreen .game-control-bar {
          height: 50px;
          padding: 10px 15px;
        }

        .game-container.fullscreen .game-frame {
          height: calc(100vh - 50px);
        }
      }

      footer {
        text-align: center;
        padding: 30px;
        background: #2c3e50;
        color: white;
        margin-top: 50px;
      }

      /* Modal Styles */
      .report-modal,
      .changelog-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-50px) scale(0.9);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 25px;
        border-bottom: 1px solid #e0e0e0;
        background: #f8f9fa;
        border-radius: 12px 12px 0 0;
      }

      .modal-header h3 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.3em;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #7f8c8d;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .close-btn:hover {
        background: #e74c3c;
        color: white;
      }

      .modal-body {
        padding: 25px;
      }

      .modal-body .form-group {
        margin-bottom: 20px;
      }

      .modal-body label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }

      .modal-body input,
      .modal-body select,
      .modal-body textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .modal-body input:focus,
      .modal-body select:focus,
      .modal-body textarea:focus {
        outline: none;
        border-color: #3498db;
      }

      .modal-body textarea {
        height: 100px;
        resize: vertical;
      }

      .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
      }

      .form-actions button {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .form-actions button[type="button"] {
        background: #95a5a6;
        color: white;
      }

      .form-actions button[type="button"]:hover {
        background: #7f8c8d;
      }

      .form-actions button[type="submit"] {
        background: #e74c3c;
        color: white;
      }

      .form-actions button[type="submit"]:hover {
        background: #c0392b;
      }

      /* Changelog specific styles */
      .changelog-entry {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e0e0e0;
      }

      .changelog-entry:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .changelog-entry h4 {
        color: #2c3e50;
        margin-bottom: 12px;
        font-size: 1.1em;
      }

      .changelog-entry ul {
        margin: 0;
        padding-left: 20px;
      }

      .changelog-entry li {
        margin-bottom: 8px;
        color: #34495e;
        line-height: 1.5;
      }

      /* Fullscreen styles */
      .game-container.fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        background: #000;
        display: flex;
        flex-direction: column;
        will-change: transform;
        transform: translateZ(0); /* 启用硬件加速 */
        backface-visibility: hidden; /* 防止渲染问题 */
      }

      .game-container.fullscreen .game-frame {
        flex: 1;
        width: 100%;
        height: calc(100vh - 60px);
        border-radius: 0;
        border: none;
        outline: none;
        will-change: auto; /* 全屏时重置will-change */
        transform: translateZ(0);
      }

      .game-container.fullscreen .game-control-bar {
        height: 60px;
        margin-top: 0;
        border-radius: 0;
        background: rgba(44, 62, 80, 0.95);
        backdrop-filter: blur(10px);
        flex-shrink: 0; /* 防止控制栏被压缩 */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="game-container" id="gameContainer">
        <!-- 加载指示器 -->
        <div class="loading-indicator" id="loadingIndicator">
          <div class="loading-spinner"></div>
          <p>Loading Wacky Flip Game...</p>
        </div>

        <iframe
          src="https://1games.io/embed/wacky-flip"
          width="1280"
          height="720"
          scrolling="no"
          frameborder="0"
          class="game-frame"
          id="gameFrame"
          title="Wacky Flip Crazy Physics Game"
          allowfullscreen
          allow="fullscreen; gamepad; microphone; camera"
          sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-modals"
          loading="lazy"
        >
          <p>
            Your browser does not support iframes.
            <a href="https://1games.io/embed/wacky-flip" target="_blank"
              >Click here to play the game</a
            >
          </p>
        </iframe>

        <!-- Game Control Bar -->
        <div class="game-control-bar">
          <div class="game-info">
            <div class="game-icon">
              <img src="favicon.svg" alt="Wacky Flip" width="32" height="32" />
            </div>
            <div class="game-details">
              <h4>Wacky Flip</h4>
            </div>
          </div>

          <div class="game-actions">
            <div class="action-group">
              <button
                class="action-btn like-btn"
                id="likeBtn"
                title="Like this game"
              >
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"
                  />
                </svg>
              </button>
              <span class="likes-count" id="likesCount">4.5k</span>
            </div>

            <div class="action-group">
              <button
                class="action-btn dislike-btn"
                id="dislikeBtn"
                title="Dislike this game"
              >
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z"
                  />
                </svg>
              </button>
              <span class="dislikes-count" id="dislikesCount">489</span>
            </div>

            <button
              class="action-btn share-btn"
              id="shareBtn"
              title="Share with friends"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"
                />
              </svg>
            </button>

            <button
              class="action-btn report-btn"
              id="reportBtn"
              title="Report an issue"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" />
              </svg>
            </button>

            <button
              class="action-btn help-btn"
              id="helpBtn"
              title="How to play"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"
                />
              </svg>
            </button>

            <button
              class="action-btn changelog-btn"
              id="changelogBtn"
              title="Change log"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"
                />
              </svg>
            </button>

            <button
              class="action-btn refresh-btn"
              id="refreshBtn"
              title="Refresh game"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                />
              </svg>
            </button>

            <button
              class="action-btn fullscreen-btn"
              id="fullscreenBtn"
              title="Toggle fullscreen"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                  d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Rating Section -->
      <div class="rating-section">
        <h3>🌟 Game Rating</h3>
        <div class="rating-display">
          <div class="rating-score" id="averageRating">4.5</div>
          <div>
            <div class="rating-stars" id="displayStars">
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
            </div>
            <div class="rating-info">
              Based on <span id="totalRatings">1,247</span> ratings
            </div>
          </div>
        </div>

        <div class="user-rating">
          <h4>Rate this game:</h4>
          <div class="rating-buttons" id="userRating">
            <button class="rating-btn unselected" data-rating="1">★</button>
            <button class="rating-btn unselected" data-rating="2">★</button>
            <button class="rating-btn unselected" data-rating="3">★</button>
            <button class="rating-btn unselected" data-rating="4">★</button>
            <button class="rating-btn unselected" data-rating="5">★</button>
          </div>
          <div id="ratingMessage"></div>
        </div>
      </div>

      <!-- Comments Section -->
      <div class="comments-section">
        <h3>💬 Player Comments</h3>

        <div class="comment-form">
          <h4>Leave a Comment</h4>
          <form id="commentForm">
            <div class="form-group">
              <label for="userName">Name:</label>
              <input
                type="text"
                id="userName"
                name="userName"
                required
                maxlength="50"
              />
            </div>
            <div class="form-group">
              <label for="userComment">Comment:</label>
              <textarea
                id="userComment"
                name="userComment"
                required
                maxlength="500"
                placeholder="Share your thoughts about Wacky Flip..."
              ></textarea>
            </div>
            <button type="submit" class="submit-btn">Post Comment</button>
          </form>
        </div>

        <div class="comments-list" id="commentsList">
          <!-- Comments will be loaded here -->
        </div>
      </div>

      <header>
        <h1>🎮 Wacky Flip - Crazy Physics Flip Game</h1>
        <p class="subtitle">
          Experience the most thrilling physics-based parkour game and master
          perfect flip techniques!
        </p>
        <div class="highlight">
          <strong
            >🎯 Free Online Game | 🚀 No Download | 🎪 Physics Engine | 🏆 Skill
            Challenge</strong
          >
        </div>
      </header>

      <section class="content-section">
        <h2>🎪 About Wacky Flip Crazy Physics Game</h2>
        <p>
          <strong>Wacky Flip</strong>
          is an addictive physics-based parkour game that perfectly combines
          real physics with pure parkour chaos. In this innovative flip game,
          you need to master backflips, pike twists, and mid-air madness, launch
          off rooftops, slam dunk into stunt hoops, and stick the most
          ridiculous landings across urban playgrounds.
        </p>

        <div class="highlight">
          <p>
            <strong>🌟 Game Features:</strong>
            The world is your stunt gym, and gravity is your playground. This
            innovative flip game perfectly blends style, skill, and serious fun!
          </p>
        </div>

        <h3>🎯 Core Gameplay</h3>
        <p>
          Wacky Flip starts simple: launch your athlete, flip through the air,
          and aim for a clean landing inside the target zone. Each flip earns
          you points—but only if you nail the landing. The more stylish and
          complex your combos, the higher your score. Just don't lose control
          midair, or it's an instant wipeout.
        </p>
      </section>

      <section class="content-section">
        <h2>🎮 How to Play Wacky Flip</h2>
        <div class="how-to-play">
          <div class="step">
            <h4>🚀 Step 1: Prepare to Launch</h4>
            <p>
              Hold the left mouse button to adjust jump power and angle. The
              power bar will show your jump intensity, and the angle determines
              your flight trajectory.
            </p>
          </div>
          <div class="step">
            <h4>🎪 Step 2: Launch into Air</h4>
            <p>
              Release the left mouse button to launch into the air. Your
              character will fly into the air according to the set power and
              angle, ready to start the flip performance.
            </p>
          </div>
          <div class="step">
            <h4>🤸 Step 3: Mid-Air Flips</h4>
            <p>
              Click the mouse while in the air to start flipping. You can
              perform various flip moves like Pike, Scissor, and Layout flips to
              earn higher scores.
            </p>
          </div>
          <div class="step">
            <h4>🎯 Step 4: Perfect Landing</h4>
            <p>
              Click the mouse again to lock the landing position. Timing is
              everything! Perfect landing timing will determine whether you get
              high scores or crash spectacularly.
            </p>
          </div>
        </div>

        <div class="controls-list">
          <h3>🎮 Game Controls</h3>
          <ul>
            <li>
              <strong>Hold Left Mouse Button:</strong> Adjust jump power and
              angle
            </li>
            <li><strong>Release Mouse:</strong> Launch into the air</li>
            <li><strong>Click in Air:</strong> Start flip action</li>
            <li>
              <strong>Click Again:</strong> Lock landing (timing is crucial)
            </li>
          </ul>
        </div>
      </section>

      <section class="content-section">
        <h2>🌟 Wacky Flip Game Advantages</h2>
        <div class="advantages">
          <div class="advantage">
            <div class="advantage-icon">🎯</div>
            <h3>Simple to Learn</h3>
            <p>
              The game mechanics are easy to understand, suitable for players of
              all ages and skill levels. Just control your character's movement
              and master the flip techniques.
            </p>
          </div>
          <div class="advantage">
            <div class="advantage-icon">🚀</div>
            <h3>No Installation Required</h3>
            <p>
              Wacky Flip is free to play and requires no downloads or
              installations. You can access the game directly from your browser
              and start playing immediately.
            </p>
          </div>
          <div class="advantage">
            <div class="advantage-icon">🧠</div>
            <h3>Enhances Focus</h3>
            <p>
              The game requires quick reflexes and concentration. As the
              character's speed increases, it helps players improve hand-eye
              coordination and reaction time.
            </p>
          </div>
          <div class="advantage">
            <div class="advantage-icon">🎪</div>
            <h3>Physics Engine Fun</h3>
            <p>
              The realistic physics engine makes every flip full of surprises.
              Even failures create hilarious ragdoll physics effects that are
              entertaining to watch.
            </p>
          </div>
          <div class="advantage">
            <div class="advantage-icon">🏆</div>
            <h3>Skill Challenge</h3>
            <p>
              Master various flip combinations, from simple backflips to complex
              consecutive moves, constantly challenging higher score records.
            </p>
          </div>
          <div class="advantage">
            <div class="advantage-icon">🎨</div>
            <h3>Style Variety</h3>
            <p>
              Multiple flip moves and landing methods allow you to create unique
              styles and impressive stunt performances.
            </p>
          </div>
        </div>
      </section>

      <section class="content-section">
        <h2>❓ Frequently Asked Questions</h2>
        <div class="faq-item">
          <div class="faq-question">How do I start playing Wacky Flip?</div>
          <div class="faq-answer">
            <p>
              Very simple! The game automatically loads in the game area above.
              Use your mouse to control the character's jumping and flipping,
              and follow the in-game prompts to start your flip adventure.
            </p>
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">What are the controls for Wacky Flip?</div>
          <div class="faq-answer">
            <p>
              In Wacky Flip, use the left mouse button to control your
              character. Hold to adjust power and angle, release to launch,
              click in air to start flipping, click again to lock landing.
            </p>
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">How do I get high scores in the game?</div>
          <div class="faq-answer">
            <p>
              Get high scores by completing complex flip combinations and
              perfect landings. Try different moves like Pike flips, Scissor
              flips, and ensure perfect landings in the target zone to get score
              multipliers.
            </p>
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">
            Are there different difficulty levels in the game?
          </div>
          <div class="faq-answer">
            <p>
              Yes, Wacky Flip contains multiple different levels and challenge
              areas, from rooftops to water towers, each area has unique stunt
              setups and difficulty challenges.
            </p>
          </div>
        </div>
        <div class="faq-item">
          <div class="faq-question">What happens if I fail a flip?</div>
          <div class="faq-answer">
            <p>
              Even failures are fun! The game's ragdoll physics engine creates
              hilarious crash effects, with each failure producing fresh and
              entertaining results.
            </p>
          </div>
        </div>
      </section>

      <section class="content-section">
        <h2>🎮 Similar Physics Sports Games</h2>
        <p>
          If you enjoy Wacky Flip, you might also like these physics-based skill
          games:
        </p>
        <ul style="margin-top: 15px; padding-left: 20px">
          <li><strong>Goal Rush</strong> - Soccer skill challenge game</li>
          <li><strong>Flip Runner</strong> - Parkour flip adventure</li>
          <li>
            <strong>Volley Random</strong> - Random volleyball physics game
          </li>
          <li>
            <strong>Basketball Superstars</strong> - Basketball skill game
          </li>
        </ul>
      </section>
    </div>

    <footer>
      <p>&copy; 2025 Wacky Flip Game Site. All rights reserved.</p>
      <p>Enjoy the best online flip game experience!</p>
    </footer>

    <script>
      // Fullscreen functionality
      let isFullscreen = false;
      const gameContainer = document.getElementById("gameContainer");
      const gameFrame = document.getElementById("gameFrame");
      const fullscreenBtn = document.getElementById("fullscreenBtn");
      const loadingIndicator = document.getElementById("loadingIndicator");
      const originalSrc = "https://1games.io/embed/wacky-flip";

      // iframe加载状态管理
      let iframeLoaded = false;
      let loadTimeout;

      // 显示加载指示器
      function showLoading() {
        if (loadingIndicator) {
          loadingIndicator.classList.remove("hidden");
        }
      }

      // 隐藏加载指示器
      function hideLoading() {
        if (loadingIndicator) {
          loadingIndicator.classList.add("hidden");
        }
      }

      // iframe加载成功处理
      function onIframeLoad() {
        console.log("Iframe loaded successfully");

        // 延迟验证，确保内容真正加载完成
        setTimeout(() => {
          // 双重验证iframe状态
          if (gameFrame.src && gameFrame.src !== "about:blank") {
            iframeLoaded = true;
            hideLoading();
            clearTimeout(loadTimeout);
            updateFullscreenButtonState(); // 更新按钮状态
            console.log("Game fully loaded and ready");
          }
        }, 1000); // 给游戏1秒时间完全初始化
      }

      // iframe加载错误处理
      function onIframeError() {
        console.log("Iframe failed to load, attempting reload...");
        iframeLoaded = false;
        showLoading();

        // 延迟重新加载
        setTimeout(() => {
          if (!iframeLoaded) {
            gameFrame.src = originalSrc;
          }
        }, 2000);
      }

      // 设置加载超时
      function setLoadTimeout() {
        clearTimeout(loadTimeout);
        loadTimeout = setTimeout(() => {
          if (!iframeLoaded) {
            console.log("Iframe load timeout, reloading...");
            onIframeError();
          }
        }, 10000); // 10秒超时
      }

      // iframe保护机制
      function protectIframe() {
        if (!gameFrame.src || gameFrame.src === "about:blank") {
          console.log("Iframe src lost, restoring...");
          iframeLoaded = false;
          showLoading();
          gameFrame.src = originalSrc;
          setLoadTimeout();
        }

        // 检查iframe是否真正加载了内容
        try {
          const frameDoc =
            gameFrame.contentDocument || gameFrame.contentWindow.document;
          if (
            frameDoc &&
            frameDoc.body &&
            frameDoc.body.innerHTML.trim() === ""
          ) {
            console.log("Iframe content is empty, reloading...");
            onIframeError();
          }
        } catch (e) {
          // 跨域时无法访问，这是正常的
          // 但如果iframe完全空白，浏览器通常不会抛出错误
        }
      }

      // 监听iframe事件
      gameFrame.addEventListener("load", onIframeLoad);
      gameFrame.addEventListener("error", onIframeError);

      // 初始化加载
      showLoading();
      setLoadTimeout();

      // 更新全屏按钮状态
      function updateFullscreenButtonState() {
        const fullscreenBtn = document.getElementById("fullscreenBtn");
        if (!iframeLoaded) {
          fullscreenBtn.style.opacity = "0.5";
          fullscreenBtn.title = "Waiting for game to load...";
          fullscreenBtn.style.cursor = "wait";
        } else {
          fullscreenBtn.style.opacity = "1";
          fullscreenBtn.title = isFullscreen
            ? "Exit fullscreen"
            : "Toggle fullscreen";
          fullscreenBtn.style.cursor = "pointer";
        }
      }

      // 初始化按钮状态
      updateFullscreenButtonState();

      // 定期检查iframe状态
      setInterval(protectIframe, 5000);

      function toggleFullscreen() {
        // 如果游戏还在加载中，先等待加载完成
        if (!iframeLoaded) {
          console.log("Game is still loading, waiting...");
          const checkLoaded = setInterval(() => {
            if (iframeLoaded) {
              clearInterval(checkLoaded);
              toggleFullscreen();
            }
          }, 500);
          return;
        }

        if (!isFullscreen) {
          enterFullscreen();
        } else {
          exitFullscreen();
        }
      }

      function enterFullscreen() {
        // 使用requestAnimationFrame确保渲染完成
        requestAnimationFrame(() => {
          // 预先检查iframe状态
          protectIframe();

          // 添加全屏类
          gameContainer.classList.add("fullscreen");
          isFullscreen = true;
          fullscreenBtn.classList.add("active");

          // 强制重绘，避免渲染问题
          gameFrame.style.display = "none";
          gameFrame.offsetHeight; // 触发重排
          gameFrame.style.display = "block";

          // Track fullscreen event
          trackEvent("game_fullscreen", {
            action: "enter",
            game: "wacky_flip",
          });

          // Update button icon for exit fullscreen
          fullscreenBtn.querySelector("svg").innerHTML =
            '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';

          // Update title
          fullscreenBtn.title = "Exit fullscreen";

          // Hide page scroll
          document.body.style.overflow = "hidden";
        });
      }

      function exitFullscreen() {
        requestAnimationFrame(() => {
          gameContainer.classList.remove("fullscreen");
          isFullscreen = false;
          fullscreenBtn.classList.remove("active");

          // 强制重绘
          gameFrame.style.display = "none";
          gameFrame.offsetHeight; // 触发重排
          gameFrame.style.display = "block";

          // Track fullscreen event
          trackEvent("game_fullscreen", {
            action: "exit",
            game: "wacky_flip",
          });

          // Update button icon for enter fullscreen
          fullscreenBtn.querySelector("svg").innerHTML =
            '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';

          // Update title
          fullscreenBtn.title = "Toggle fullscreen";

          // Restore page scroll
          document.body.style.overflow = "";

          // 延迟检查iframe状态，确保渲染完成
          setTimeout(() => {
            protectIframe();
          }, 500);
        });
      }

      // Fullscreen button click handler
      fullscreenBtn.addEventListener("click", toggleFullscreen);

      // Keyboard shortcuts for fullscreen
      document.addEventListener("keydown", (e) => {
        // F key for fullscreen toggle
        if (e.key === "f" || e.key === "F") {
          e.preventDefault();
          toggleFullscreen();
        }
        // Escape key to exit fullscreen
        if (e.key === "Escape" && isFullscreen) {
          exitFullscreen();
        }
      });

      // Analytics Event Tracking
      function trackEvent(eventName, eventData = {}) {
        // Google Analytics
        if (typeof gtag !== "undefined") {
          gtag("event", eventName, eventData);
        }

        // Vercel Analytics
        if (typeof window.va !== "undefined") {
          window.va("track", eventName, eventData);
        }
      }

      // Rating System with daily limits and analytics
      let userRating = 0;
      const ratings =
        JSON.parse(localStorage.getItem("wackyFlipRatings")) || [];
      const userActions =
        JSON.parse(localStorage.getItem("wackyFlipUserActions")) || {};

      // Get today's date string
      function getTodayString() {
        return new Date().toDateString();
      }

      // Check if user has already rated today
      function hasRatedToday() {
        const today = getTodayString();
        return userActions.lastRatingDate === today;
      }

      // Check if user has commented today
      function hasCommentedToday() {
        const today = getTodayString();
        return (
          userActions.lastCommentDate === today && userActions.commentCount >= 3
        ); // Allow 3 comments per day
      }

      function updateDisplayRating() {
        const avgRating =
          ratings.length > 0
            ? (
                ratings.reduce((sum, rating) => sum + rating, 0) /
                ratings.length
              ).toFixed(1)
            : 4.5;
        const totalRatings = ratings.length > 0 ? ratings.length : 1247;

        document.getElementById("averageRating").textContent = avgRating;
        document.getElementById("totalRatings").textContent =
          totalRatings.toLocaleString();

        // Update display stars
        const stars = document.querySelectorAll("#displayStars .star");
        const rating = parseFloat(avgRating);
        stars.forEach((star, index) => {
          star.classList.remove("empty");
          star.style.background = "";
          star.style.webkitBackgroundClip = "";
          star.style.webkitTextFillColor = "";

          if (index >= Math.floor(rating)) {
            if (index < rating) {
              // Half star effect
              star.style.background =
                "linear-gradient(90deg, #ffd700 50%, #ddd 50%)";
              star.style.webkitBackgroundClip = "text";
              star.style.webkitTextFillColor = "transparent";
            } else {
              star.classList.add("empty");
            }
          }
        });
      }

      // Initialize rating buttons
      function initializeRatingButtons() {
        const ratingButtons = document.querySelectorAll(".rating-btn");
        const ratingMessage = document.getElementById("ratingMessage");

        if (hasRatedToday()) {
          // Disable rating if already rated today
          ratingButtons.forEach((btn) => {
            btn.disabled = true;
            btn.style.opacity = "0.5";
            btn.style.cursor = "not-allowed";
          });
          ratingMessage.innerHTML = `<p style="color: #e74c3c; margin-top: 10px;">You have already rated this game today. Come back tomorrow to rate again!</p>`;
        } else {
          // Enable rating buttons
          ratingButtons.forEach((btn) => {
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.style.cursor = "pointer";
          });
        }
      }

      // User rating interaction with analytics
      document.querySelectorAll(".rating-btn").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          if (hasRatedToday()) {
            e.preventDefault();
            return;
          }

          const rating = parseInt(btn.dataset.rating);
          userRating = rating;

          // Track rating event
          trackEvent("game_rated", {
            rating: rating,
            game: "wacky_flip",
          });

          // Update button states
          document.querySelectorAll(".rating-btn").forEach((button, index) => {
            if (index < rating) {
              button.classList.remove("unselected");
              button.classList.add("selected");
            } else {
              button.classList.remove("selected");
              button.classList.add("unselected");
            }
          });

          // Save rating and user action
          ratings.push(rating);
          localStorage.setItem("wackyFlipRatings", JSON.stringify(ratings));

          // Update user actions
          userActions.lastRatingDate = getTodayString();
          localStorage.setItem(
            "wackyFlipUserActions",
            JSON.stringify(userActions)
          );

          updateDisplayRating();

          document.getElementById(
            "ratingMessage"
          ).innerHTML = `<p style="color: #27ae60; margin-top: 10px;">Thanks for rating! You gave ${rating} star${
            rating > 1 ? "s" : ""
          }. You can rate again tomorrow!</p>`;

          // Disable further rating
          initializeRatingButtons();
        });
      });

      // Comments System with daily limits and analytics
      const comments = JSON.parse(
        localStorage.getItem("wackyFlipComments")
      ) || [
        {
          author: "GameMaster2024",
          text: "This game is absolutely amazing! The physics are so realistic and the stunts are incredible. I've been playing for hours!",
          date: "2025-01-15T10:30:00Z",
        },
        {
          author: "FlipKing",
          text: "Love the ragdoll physics when you crash! Even failing is fun in this game. Great work on the controls too.",
          date: "2025-01-14T15:45:00Z",
        },
        {
          author: "StuntLover",
          text: "The variety of flips and tricks you can do is impressive. Each level brings new challenges. Highly recommended!",
          date: "2025-01-13T09:20:00Z",
        },
      ];

      function formatDate(dateString) {
        const date = new Date(dateString);
        return (
          date.toLocaleDateString() +
          " at " +
          date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })
        );
      }

      function renderComments() {
        const commentsList = document.getElementById("commentsList");

        if (comments.length === 0) {
          commentsList.innerHTML =
            '<div class="no-comments">No comments yet. Be the first to share your thoughts!</div>';
          return;
        }

        commentsList.innerHTML = comments
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .map(
            (comment) => `
            <div class="comment">
              <div class="comment-header">
                <span class="comment-author">${escapeHtml(
                  comment.author
                )}</span>
                <span class="comment-date">${formatDate(comment.date)}</span>
              </div>
              <div class="comment-text">${escapeHtml(comment.text)}</div>
            </div>
          `
          )
          .join("");
      }

      // Escape HTML to prevent XSS
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Initialize comment form
      function initializeCommentForm() {
        const submitBtn = document.querySelector(".submit-btn");
        const commentForm = document.getElementById("commentForm");

        if (hasCommentedToday()) {
          submitBtn.disabled = true;
          submitBtn.style.opacity = "0.5";
          submitBtn.style.cursor = "not-allowed";
          submitBtn.textContent = "Daily Comment Limit Reached";

          // Add warning message
          const existingWarning = document.querySelector(".comment-warning");
          if (!existingWarning) {
            const warning = document.createElement("div");
            warning.className = "comment-warning";
            warning.style.cssText =
              "color: #e74c3c; margin-top: 10px; font-size: 0.9em;";
            warning.textContent =
              "You have reached the daily comment limit (3 comments). Come back tomorrow!";
            commentForm.appendChild(warning);
          }
        } else {
          submitBtn.disabled = false;
          submitBtn.style.opacity = "1";
          submitBtn.style.cursor = "pointer";
          submitBtn.textContent = "Post Comment";

          // Remove warning if exists
          const existingWarning = document.querySelector(".comment-warning");
          if (existingWarning) {
            existingWarning.remove();
          }
        }
      }

      // Comment form submission with analytics
      document.getElementById("commentForm").addEventListener("submit", (e) => {
        e.preventDefault();

        if (hasCommentedToday()) {
          alert(
            "You have reached the daily comment limit. Please try again tomorrow!"
          );
          return;
        }

        const userName = document.getElementById("userName").value.trim();
        const userComment = document.getElementById("userComment").value.trim();

        // Validation
        if (!userName || !userComment) {
          alert("Please fill in both name and comment fields.");
          return;
        }

        if (userName.length > 50) {
          alert("Name must be 50 characters or less.");
          return;
        }

        if (userComment.length > 500) {
          alert("Comment must be 500 characters or less.");
          return;
        }

        // Check for spam (simple check)
        if (userComment.length < 10) {
          alert("Comment must be at least 10 characters long.");
          return;
        }

        // Track comment event
        trackEvent("comment_posted", {
          game: "wacky_flip",
          comment_length: userComment.length,
        });

        const newComment = {
          author: userName,
          text: userComment,
          date: new Date().toISOString(),
        };

        comments.push(newComment);
        localStorage.setItem("wackyFlipComments", JSON.stringify(comments));

        // Update user actions
        const today = getTodayString();
        if (userActions.lastCommentDate === today) {
          userActions.commentCount = (userActions.commentCount || 0) + 1;
        } else {
          userActions.lastCommentDate = today;
          userActions.commentCount = 1;
        }
        localStorage.setItem(
          "wackyFlipUserActions",
          JSON.stringify(userActions)
        );

        // Clear form
        document.getElementById("userName").value = "";
        document.getElementById("userComment").value = "";

        // Re-render comments
        renderComments();

        // Show success message
        alert("Comment posted successfully!");

        // Update form state
        initializeCommentForm();
      });

      // Track game interactions
      document.querySelector(".game-frame").addEventListener("load", () => {
        trackEvent("game_loaded", {
          game: "wacky_flip",
        });
      });

      // FAQ interaction with analytics
      document.querySelectorAll(".faq-question").forEach((question) => {
        question.addEventListener("click", () => {
          const answer = question.nextElementSibling;
          const isVisible = answer.style.display === "block";

          // Track FAQ interaction
          trackEvent("faq_interaction", {
            question: question.textContent,
            action: isVisible ? "close" : "open",
          });

          // Hide all answers
          document.querySelectorAll(".faq-answer").forEach((ans) => {
            ans.style.display = "none";
          });

          // Show/hide current answer
          answer.style.display = isVisible ? "none" : "block";
        });
      });

      // Responsive game frame adjustment
      function adjustGameFrame() {
        const gameFrame = document.querySelector(".game-frame");
        const container = document.querySelector(".game-container");

        if (!gameFrame || !container) return;

        const containerWidth = container.offsetWidth - 40; // minus padding

        if (window.innerWidth <= 768) {
          gameFrame.style.width = "100%";
          gameFrame.style.height = "400px";
        } else if (containerWidth < 1280) {
          gameFrame.style.width = "100%";
          gameFrame.style.height = Math.floor(containerWidth * 0.5625) + "px"; // 16:9 ratio
        }
      }

      // Clean up old data (optional - runs once per day)
      function cleanupOldData() {
        const today = getTodayString();
        const lastCleanup = localStorage.getItem("lastCleanup");

        if (lastCleanup !== today) {
          // Reset daily counters if it's a new day
          const actions =
            JSON.parse(localStorage.getItem("wackyFlipUserActions")) || {};
          if (actions.lastRatingDate !== today) {
            delete actions.lastRatingDate;
          }
          if (actions.lastCommentDate !== today) {
            delete actions.lastCommentDate;
            delete actions.commentCount;
          }
          localStorage.setItem("wackyFlipUserActions", JSON.stringify(actions));
          localStorage.setItem("lastCleanup", today);
        }
      }

      // Page view tracking
      trackEvent("page_view", {
        page_title: document.title,
        page_location: window.location.href,
      });

      // Initialize everything
      window.addEventListener("resize", adjustGameFrame);
      window.addEventListener("load", () => {
        try {
          cleanupOldData();
          adjustGameFrame();
          updateDisplayRating();
          renderComments();
          initializeRatingButtons();
          initializeCommentForm();
          updateGameStats(); // Initialize game control bar stats

          // Handle report form submission
          document.addEventListener("submit", (e) => {
            if (e.target.id === "reportForm") {
              e.preventDefault();
              const issueType = document.getElementById("issueType").value;
              const email = document.getElementById("reportEmail").value;
              const description =
                document.getElementById("reportDescription").value;

              if (!issueType || !description) {
                alert("Please fill in all required fields.");
                return;
              }

              // Track report submission
              trackEvent("issue_reported", {
                issue_type: issueType,
                has_email: !!email,
                description_length: description.length,
                game: "wacky_flip",
              });

              // Simulate report submission
              alert(
                "Thank you for your report! We will review it and take appropriate action."
              );
              closeReportModal();
            }
          });
        } catch (error) {
          console.error("Initialization error:", error);
        }
      });

      // Game Control Bar functionality
      let userLiked = localStorage.getItem("wackyFlipLiked") === "true";
      let userDisliked = localStorage.getItem("wackyFlipDisliked") === "true";
      let likesCount =
        parseInt(localStorage.getItem("wackyFlipLikesCount")) || 4500;
      let dislikesCount =
        parseInt(localStorage.getItem("wackyFlipDislikesCount")) || 489;

      function updateGameStats() {
        document.getElementById("likesCount").textContent =
          formatCount(likesCount);
        document.getElementById("dislikesCount").textContent =
          formatCount(dislikesCount);

        // Update button states
        const likeBtn = document.getElementById("likeBtn");
        const dislikeBtn = document.getElementById("dislikeBtn");

        if (userLiked) {
          likeBtn.classList.add("active");
        } else {
          likeBtn.classList.remove("active");
        }

        if (userDisliked) {
          dislikeBtn.classList.add("active");
        } else {
          dislikeBtn.classList.remove("active");
        }
      }

      function formatCount(count) {
        if (count >= 1000) {
          return (count / 1000).toFixed(1) + "k";
        }
        return count.toString();
      }

      // Like button functionality
      document.getElementById("likeBtn").addEventListener("click", () => {
        if (userLiked) {
          // Unlike
          userLiked = false;
          likesCount--;
          trackEvent("game_unliked", { game: "wacky_flip" });
        } else {
          // Like
          userLiked = true;
          likesCount++;
          // Remove dislike if active
          if (userDisliked) {
            userDisliked = false;
            dislikesCount--;
          }
          trackEvent("game_liked", { game: "wacky_flip" });
        }

        localStorage.setItem("wackyFlipLiked", userLiked);
        localStorage.setItem("wackyFlipDisliked", userDisliked);
        localStorage.setItem("wackyFlipLikesCount", likesCount);
        localStorage.setItem("wackyFlipDislikesCount", dislikesCount);
        updateGameStats();
      });

      // Dislike button functionality
      document.getElementById("dislikeBtn").addEventListener("click", () => {
        if (userDisliked) {
          // Remove dislike
          userDisliked = false;
          dislikesCount--;
          trackEvent("game_undisliked", { game: "wacky_flip" });
        } else {
          // Dislike
          userDisliked = true;
          dislikesCount++;
          // Remove like if active
          if (userLiked) {
            userLiked = false;
            likesCount--;
          }
          trackEvent("game_disliked", { game: "wacky_flip" });
        }

        localStorage.setItem("wackyFlipLiked", userLiked);
        localStorage.setItem("wackyFlipDisliked", userDisliked);
        localStorage.setItem("wackyFlipLikesCount", likesCount);
        localStorage.setItem("wackyFlipDislikesCount", dislikesCount);
        updateGameStats();
      });

      // Share button functionality
      document
        .getElementById("shareBtn")
        .addEventListener("click", async () => {
          const shareData = {
            title: "Wacky Flip - Physics Flip Game",
            text: "Check out this amazing physics-based flip game! Master crazy stunts and perfect landings.",
            url: window.location.href,
          };

          try {
            if (navigator.share) {
              await navigator.share(shareData);
              trackEvent("game_shared", {
                method: "native",
                game: "wacky_flip",
              });
            } else {
              // Fallback to clipboard
              await navigator.clipboard.writeText(window.location.href);
              alert(
                "Game link copied to clipboard! Share it with your friends."
              );
              trackEvent("game_shared", {
                method: "clipboard",
                game: "wacky_flip",
              });
            }
          } catch (err) {
            console.log("Share failed:", err);
            // Fallback to manual copy
            const textArea = document.createElement("textarea");
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            alert("Game link copied to clipboard!");
            trackEvent("game_shared", {
              method: "fallback",
              game: "wacky_flip",
            });
          }
        });

      // Report button functionality
      document.getElementById("reportBtn").addEventListener("click", () => {
        const modal = createReportModal();
        document.body.appendChild(modal);
        trackEvent("report_modal_opened", { game: "wacky_flip" });
      });

      function createReportModal() {
        const modal = document.createElement("div");
        modal.className = "report-modal";
        modal.innerHTML = `
          <div class="modal-overlay" onclick="closeReportModal()"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3>🚨 Report an Issue</h3>
              <button class="close-btn" onclick="closeReportModal()">×</button>
            </div>
            <div class="modal-body">
              <form id="reportForm">
                <div class="form-group">
                  <label for="issueType">What issue did you find?</label>
                  <select id="issueType" required>
                    <option value="">Select an issue type</option>
                    <option value="bug">Game Bug</option>
                    <option value="loading">Loading Problem</option>
                    <option value="performance">Performance Issue</option>
                    <option value="inappropriate">Inappropriate Content</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="reportEmail">Your Email (Optional)</label>
                  <input type="email" id="reportEmail" placeholder="your@email.com">
                </div>
                <div class="form-group">
                  <label for="reportDescription">Describe the issue</label>
                  <textarea id="reportDescription" required placeholder="Please describe the issue in detail..."></textarea>
                </div>
                <div class="form-actions">
                  <button type="button" onclick="closeReportModal()">Cancel</button>
                  <button type="submit">Send Report</button>
                </div>
              </form>
            </div>
          </div>
        `;
        return modal;
      }

      window.closeReportModal = function () {
        const modal = document.querySelector(".report-modal");
        if (modal) {
          modal.remove();
        }
      };

      // Help button functionality
      document.getElementById("helpBtn").addEventListener("click", () => {
        // Scroll to how-to-play section
        const howToPlaySection = document.querySelector("h2");
        if (howToPlaySection) {
          howToPlaySection.scrollIntoView({ behavior: "smooth" });
          trackEvent("help_clicked", { game: "wacky_flip" });
        }
      });

      // Changelog button functionality
      document.getElementById("changelogBtn").addEventListener("click", () => {
        const modal = createChangelogModal();
        document.body.appendChild(modal);
        trackEvent("changelog_opened", { game: "wacky_flip" });
      });

      // Refresh button functionality
      document.getElementById("refreshBtn").addEventListener("click", () => {
        // Show loading indicator
        showLoading();

        // Reset iframe state
        iframeLoaded = false;

        // Force reload the iframe
        const currentSrc = gameFrame.src;
        gameFrame.src = "about:blank";

        setTimeout(() => {
          gameFrame.src = originalSrc;
          setLoadTimeout();
        }, 100);

        // Track refresh event
        trackEvent("game_refreshed", {
          game: "wacky_flip",
          manual_refresh: true,
        });

        console.log("Game manually refreshed by user");
      });

      function createChangelogModal() {
        const modal = document.createElement("div");
        modal.className = "changelog-modal";
        modal.innerHTML = `
          <div class="modal-overlay" onclick="closeChangelogModal()"></div>
          <div class="modal-content">
            <div class="modal-header">
              <h3>📋 Game Updates & Changelog</h3>
              <button class="close-btn" onclick="closeChangelogModal()">×</button>
            </div>
            <div class="modal-body">
              <div class="changelog-entry">
                <h4>Version 1.2.0 - January 2025</h4>
                <ul>
                  <li>✨ Added fullscreen mode for immersive gaming</li>
                  <li>🎮 Improved game controls and responsiveness</li>
                  <li>📱 Enhanced mobile experience</li>
                  <li>🔧 Fixed various physics engine bugs</li>
                </ul>
              </div>
              <div class="changelog-entry">
                <h4>Version 1.1.0 - December 2024</h4>
                <ul>
                  <li>🎪 Added new flip combinations</li>
                  <li>🏆 Improved scoring system</li>
                  <li>🎨 Enhanced visual effects</li>
                  <li>⚡ Performance optimizations</li>
                </ul>
              </div>
              <div class="changelog-entry">
                <h4>Version 1.0.0 - November 2024</h4>
                <ul>
                  <li>🚀 Initial game release</li>
                  <li>🎯 Basic flip mechanics</li>
                  <li>🎪 Physics engine implementation</li>
                  <li>📱 Cross-platform support</li>
                </ul>
              </div>
            </div>
          </div>
        `;
        return modal;
      }

      window.closeChangelogModal = function () {
        const modal = document.querySelector(".changelog-modal");
        if (modal) {
          modal.remove();
        }
      };
    </script>
  </body>
</html>
